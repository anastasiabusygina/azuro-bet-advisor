# Azuro API Client Tools

Набор инструментов для работы с API Azuro Protocol, который позволяет получать информацию о матчах, доступных ставках и их представлении в виде, соответствующем пользовательскому интерфейсу.

## Назначение проекта

Проект предназначен для получения данных о предстоящих спортивных матчах, доступных для ставок через Azuro Protocol. Основная задача - предоставить пользователю информацию о матчах с удобным форматированием, чтобы:

1. Просматривать предстоящие спортивные события (футбол, баскетбол и др.) на определенный временной период
2. Видеть время начала матчей как в UTC, так и в московском времени (МСК)
3. Передавать данные о матчах ИИ-боту для анализа и получения рекомендаций по ставкам
4. Сопоставлять рекомендации бота с конкретными кнопками в интерфейсе Azuro для осуществления ставок

Типичный сценарий использования:
- Получение списка предстоящих матчей на ближайшие сутки
- Анализ данных ИИ-ботом (внешний компонент)
- Получение рекомендаций от бота с указанием ID матча, условия и исхода
- Определение конкретной кнопки в интерфейсе Azuro для совершения ставки

## Структура проекта

```
├── azuro/                 # Базовые компоненты для работы с Azuro API
│   ├── client.ts          # Конфигурация GraphQL клиента
│   ├── types.ts           # Типы данных для Azuro API
│   └── queries/           # GraphQL запросы
│       ├── getBetsQuery.ts    # Запрос для получения информации о ставках
│       ├── getMatchesQuery.ts # Запрос для получения списка матчей
│       └── getSportsQuery.ts  # Запрос для получения списка видов спорта
├── config/                # Конфигурационные файлы
│   ├── output/            # Директория для выходных файлов
│   ├── settings/          # Директория для пользовательских настроек
│   ├── temp/              # Директория для временных файлов
│   └── match_data/        # Локальные данные о матчах (если используются)
├── data/                  # Данные и примеры
│   └── examples/          # Примеры данных
│       ├── match.md       # Пример данных о матче
│       └── match_buttons.txt # Пример вывода кнопок ставок
├── docs/                  # Документация
│   └── task.md            # Описание задачи
├── scripts/               # Скрипты для работы с API
│   ├── bash/              # Bash скрипты
│   │   ├── get_match_buttons.sh    # Скрипт для получения кнопок матча
│   │   └── show_upcoming_matches.sh # Скрипт для отображения предстоящих матчей
│   ├── ts/                # TypeScript скрипты
│   │   └── fetchAndFormatMatches.standalone.ts # Основной TS скрипт для получения матчей
│   ├── data/              # Данные, сохраненные скриптами
│   │   └── matches/       # Сохраненные данные о матчах
│   └── utils/             # Вспомогательные скрипты
│       └── fetch-matches-standalone.sh # Скрипт для запуска обновления матчей
├── temp_storage/          # Временное хранилище для неиспользуемых файлов
├── .env                   # Переменные окружения
├── get_match_buttons.sh   # Символическая ссылка на scripts/bash/get_match_buttons.sh
├── show_upcoming_matches.sh # Символическая ссылка на scripts/bash/show_upcoming_matches.sh
├── package.json           # Зависимости проекта
└── tsconfig.json          # Конфигурация TypeScript
```

## Основные компоненты

### 1. TypeScript скрипт (современный метод)

Основной TypeScript скрипт для получения информации о матчах из Azuro API:

```bash
# Получить матчи с настройками по умолчанию
npm run fetch

# Получить только футбольные матчи
npm run fetch:football 

# Получить только баскетбольные матчи
npm run fetch:basketball
```

Результаты сохраняются в `scripts/data/matches/` в формате Markdown.

#### Особенности форматирования времени

Для удобного планирования ставок, время начала матчей отображается в двух форматах:
- UTC (всемирное координированное время)
- МСК (московское время, UTC+3)

Это позволяет быстро ориентироваться в расписании предстоящих матчей без необходимости конвертации временных зон.

### 2. Bash скрипты (альтернативный метод)

#### Получение информации о конкретном матче

Скрипт `get_match_buttons.sh` для получения информации о матчах и доступных ставках с форматированием, соответствующим UI:

```bash
# Показать список доступных матчей
./get_match_buttons.sh --list

# Получить информацию о конкретном матче
./get_match_buttons.sh GAME_ID

# Получить информацию о матче с указанием идентификаторов ставки
./get_match_buttons.sh -c CONDITION_ID -o OUTCOME_ID GAME_ID

# Получить справку
./get_match_buttons.sh --help
```

Результаты выводятся в консоль и сохраняются в файлы:
- `config/output/match_buttons.txt` (текстовый формат)
- `config/output/match_buttons.json` (JSON формат)

#### Отображение предстоящих матчей

Скрипт `show_upcoming_matches.sh` для отображения списка предстоящих матчей и доступных ставок:

```bash
# Показать матчи на ближайший час
./show_upcoming_matches.sh

# Показать футбольные матчи на ближайший час
./show_upcoming_matches.sh --sport Football

# Показать матчи на ближайшие 3 часа
./show_upcoming_matches.sh --time 3

# Показать матчи с отображением типов ставок
./show_upcoming_matches.sh --outcome-type

# Вывести результат в формате JSON
./show_upcoming_matches.sh --json

# Получить справку
./show_upcoming_matches.sh --help
```

Результаты сохраняются в файлы:
- `config/output/upcoming_matches.txt` (текстовый формат)
- `config/output/upcoming_matches.json` (JSON формат)

## Как узнать какую кнопку рекомендует ИИ-бот

Когда ИИ-бот рекомендует ставку, он предоставляет три ключевых параметра:

```json
{
  "gameId": "1006000000000026766328", 
  "conditionId": "100610060000000000267663280000000000000717820945",
  "outcomeId": "181",
  "confidence": 80,
  "reasoning": "..."
}
```

### Быстрая инструкция в 3 шага:

#### 1️⃣ Скопируйте данные из рекомендации

Возьмите из рекомендации бота три значения:
- `gameId` (ID матча)
- `conditionId` (ID типа ставки)
- `outcomeId` (ID исхода)

#### 2️⃣ Запустите скрипт

```bash
./get_match_buttons.sh -c 100610060000000000267663280000000000000717820945 -o 181 1006000000000026766328
```

#### 3️⃣ Найдите рекомендованную ставку

В результате скрипт выведет:

```
★★★★★ РЕКОМЕНДОВАННАЯ СТАВКА ★★★★★
Тип ставки: Total Goals
Параметр: 2.5
Исход: Outcome #181
Коэффициент: 3.92 (+)
...
```

Теперь вы точно знаете, что нужно искать кнопку **"Total Goals"** с параметром **"2.5"** и коэффициентом около **3.92**.

### Дополнительные советы:

1. Для максимально краткого вывода используйте флаг `-b`:
   ```bash
   ./get_match_buttons.sh -b -c 100610060000000000267663280000000000000717820945 -o 181 1006000000000026766328
   ```
   Вы получите только самую важную информацию:
   ```
   НАЖМИТЕ КНОПКУ: Total Goals
   ПАРАМЕТР: 2.5
   ИСХОД: Outcome #181
   КОЭФФИЦИЕНТ: 3.918549604138
   ```

2. Чтобы увидеть больше деталей, добавьте флаг `-q false`:
   ```bash
   ./get_match_buttons.sh -q false -c 100610060000000000267663280000000000000717820945 -o 181 1006000000000026766328
   ```

3. Для поиска нужной кнопки:
   - Найдите в интерфейсе раздел с указанным типом ставки (например, "Total Goals")
   - Найдите вариант с указанным параметром (например, "2.5") 
   - Выберите кнопку с указанным исходом и коэффициентом

4. Если названия исходов не отображаются, ориентируйтесь на коэффициент и тип ставки.

### Важно:
Обращайте внимание на раздел "Тип ставки" и "Параметр" в выводе скрипта. Они точно указывают, в каком разделе интерфейса искать нужную кнопку.

## Настройка

Конфигурация осуществляется через файл `.env`:

```
RPC_URL=...
MAINNET_GRAPH_URL=https://thegraph.azuro.org/subgraphs/name/azuro-protocol/azuro-api-polygon-v3
```

## Требования

- Node.js 18+
- npm
- bash (для скриптов *.sh)
- jq (для обработки JSON в bash скриптах) 